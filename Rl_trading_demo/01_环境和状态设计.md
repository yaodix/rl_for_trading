### 状态设计

是否包含当日(或其他period)数据值？

### 金融市场状态空间设计

考虑：No st**ationarity of the data（数据的非平稳性）**

**非平稳性**是金融市场数据最本质的特征，也是定义状态空间时**必须特殊考虑**的核心问题。

#### **非平稳性在金融市场的表现**

| 特征               | 含义                                 | 对状态空间的影响                       |
| ------------------ | ------------------------------------ | -------------------------------------- |
| **均值漂移** | 股价长期上涨/下跌                    | 今天的100元和10年前的100元含义完全不同 |
| **方差时变** | 波动率聚集（高波/低波交替）          | 同样的涨跌幅在不同时期代表不同风险水平 |
| **分布变化** | 市场结构突变（政策、危机、制度切换） | 历史分布无法预测未来分布               |

#### **状态空间设计必须应对非平稳性**

如果忽略非平稳性，直接使用**原始价格、原始收益率**作为状态特征，会导致：

#### ❌ **错误做法**

```python
# 直接把价格输入模型
state = [close_price, volume, rsi]
```

**问题**：模型学到的是“价格=100时买入”，但100元在牛市是低价，在熊市是高价，模型无所适从。

#### **正确做法：非平稳性处理技术**

| 方法                  | 原理                 | 示例                          |
| --------------------- | -------------------- | ----------------------------- |
| **滚动归一化**  | 用局部统计量标准化   | (price - 近期均值)/近期标准差 |
| **差分/收益率** | 将价格转为平稳序列   | log(price_t / price_{t-1})    |
| **相对指标**    | 与其他资产的比值     | 股票/大盘、个股/行业          |
| **分位数排名**  | 横截面相对强弱       | 当前价格在历史百分位          |
| **状态识别**    | 显式加入市场状态变量 | 加入VIX、波动率 regime        |

---

## 🎯 **一句话总结**

> **金融状态空间设计的核心不是“如何准确描述当前”，而是“如何在非平稳环境中找到相对稳定的表示”。**
