### 数据工程

数据准备参考udacity课程part05。

#### 数据获取

#### 数据清理

* Data Cleaning
  * nan

#### 数据训练准备：

* 包含原price用于计算买卖
* log_return使用（计算奖励时使用该种方式？符合累加特性？)
* 特征向量选择够用，但不过多
* 构建时序多维特征矩阵，windows > 1
* 特征滚动归一化，防止某个特征因为scale起支配地位


### **Steps Involved:**

---

**1. Data Importation**

* Utilize libraries for data handling (e.g., pandas, numpy)
* Import data from CSV files; Google stock data used as an example

**2. Data Examination**

* Review original data structure and content
* Key columns include: date, open, high, low, close, adjusted close, and volume

**3. Indexing by Date**

* Set date column as the dataset index
* Critical for time series analysis to avoid lookahead biases

**4. Data Visualization**

* Plot price and volume data over time
* Visually identify anomalies, gaps, or unusual patterns

**5. Identifying and Cleaning Missing Data**

* Use pandas to count missing values in each column
* Apply "forward fill" method to address gaps
* Maintain data accuracy without introducing future bias

**6. Final Data Check**

* Verify complete absence of null values in the cleaned dataset
* Confirm data integrity before proceeding to feature engineering

**Summary**

Understanding these steps ensures data integrity(完整性) and prepares you for sophisticated financial analysis. After cleaning the data, the course will proceed to feature definition and model development.

![1770899276793](image/00_数据准备/1770899276793.png)

上面对滚动归一化在金融市场的理解完全正确，涵盖了**统计学原理、金融数据特性、模型训练优势**三个层次。以下是针对你总结的**补充深化**，帮助你在面试或项目答辩中更具说服力：

---

## 🧠 **一、市场情境适配：不仅仅是“更新”，而是“条件分布建模”**

你提到“金融数据是非平稳的”，这是滚动归一化的**根本动机**。

**深化理解**：

- 全局归一化假设数据服从**固定分布**（i.i.d.），这在金融中不成立。
- 滚动归一化本质上是**对条件分布 P(X_t | X_{t-w:t-1}) 进行标准化**，而不是对边缘分布 P(X) 标准化。
- **意义**：模型学习的是“在当前市场环境下，这个价格是否异常”，而不是“在全部历史中，这个价格是否异常”。

**面试话术**：

> “滚动归一化不是简单更新统计量，而是将全局分布建模问题转化为局部条件分布建模问题，更符合金融市场的时变结构。”

---

## 📉 **二、离群值限制：从“扭曲”到“特征”**

你指出“将离群值局限在特定时期”，这是滚动归一化**最被低估的优势**。

**深化理解**：

- 在全局归一化中，离群值**污染未来所有数据**（均值被拉偏，方差被拉大）。
- 在滚动归一化中，离群值**成为局部特征**：它只在窗口期内产生极端 z-score，窗口滑过后立即失效。
- **金融意义**：2020年疫情底是**买入信号**，不是**永久基准**。滚动归一化自动实现这种“记忆衰减”。

**例子补充**：

```python
# 全局：50元在2021年仍是-2.3σ → 误判为低估
# 滚动：50元只在2020年3月是-12σ → 强烈买入信号
#       2021年120元是+5σ → 强烈突破信号
```

---

## ⚡ **三、数据相关性与准确性：强调“近期”的贝叶斯视角**

你提到“强调近期观测”，这其实隐含了**时变权重**的思想。

**深化理解**：

- 滚动窗口是**均匀权重**（窗口内等权，窗口外为0）。
- 这可以看作是一种**极端形式的指数加权**（EMA with β=0 after window）。
- **优势**：在市场结构突变（regime switching）时，滚动窗口比EMA**重置更快**，因为旧数据被完全丢弃，而不是缓慢衰减。

**对比**：

| 方法                 | 权重形式                      | 突变适应速度     |
| -------------------- | ----------------------------- | ---------------- |
| 全局归一化           | 所有时间等权                  | ❌ 极慢          |
| EMA归一化            | 指数衰减                      | ⚠️ 中等        |
| **滚动归一化** | **窗口内等权，窗口外0** | ✅**最快** |

---

## 🤖 **四、对学习模型的好处：不仅仅是“稳定”，而是“解耦”**

你提到“增加稳定性与性能”，这可以从**优化视角**解释。

**深化理解**：

- 神经网络等模型对**输入尺度极度敏感**。
- 全局归一化导致**不同时期相同数值有完全不同的语义** → 模型需要同时学习“市场状态识别”和“交易策略”，**耦合度过高**。
- 滚动归一化**将市场状态识别外置为特征工程** → 模型只需学习“给定当前标准化特征，如何交易”，**任务解耦，收敛更快**。

**面试话术**：

> “滚动归一化相当于把‘判断当前市场是高波动还是低波动’这个任务从模型内部转移到了特征工程层面，大幅降低了模型的学习复杂度。”

---

## 🔁 **五、增量学习支持：与在线学习天然兼容**

你提到“支持随新数据演化的模型”，这是滚动归一化在**生产环境**的核心优势。

**深化理解**：

- 滚动归一化**不需要存储全部历史数据**，只需维护一个固定长度的缓冲区（circular buffer）。
- 计算复杂度 O(1) per step（如果使用增量更新算法）。
- **与在线强化学习（如Policy Gradient、DDPG）天然兼容**：每个 episode 结束后可直接用最新窗口更新归一化参数，无需重新扫描历史。

---

## 🧩 **六、结论升华：滚动归一化的本质**

**你可以这样总结：**

> **滚动归一化不是一种简单的预处理技巧，而是一种“归纳偏置” —— 它告诉模型：当前时刻的状态只与最近的历史相关，更早的数据应当被遗忘。这种偏置极其适合金融这种非平稳、带突变、含离群值的数据环境。**

---

## 📌 **一句话终极总结（面试用）**

> **滚动归一化通过局部滑动窗口动态标准化金融数据，既消除了非平稳性对模型训练的干扰，又严格避免了未来信息泄露，同时将离群值从“永久污染源”转化为“局部特征信号”，是连接原始市场数据与高效学习模型的桥梁。**

如果需要，我可以帮你把这套理解做成**一页面试核心卡片**（PDF/图片格式），方便复习。
